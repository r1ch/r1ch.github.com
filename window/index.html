<html>
  <head>
    <title>Bradi.sh</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="d3-delaunay.min.js"></script>
    <script src="paths.js"></script>
  </head>
  <body>
     <div id = "d3" style="width:100 vw;height:100 vh"></div>
     <script>
        let data = {
          fullWidth:800,
          fullHeight:300,
          radius:5,
          margin:{
            left:10,
            right:10,
            top:10,
            bottom:10,
          }
        };
        data.width = data.fullWidth - data.margin.left - data.margin.right
        data.height = data.fullHeight - data.margin.top - data.margin.bottom
        let svg = d3.select("#d3")
        .append("svg")
        .attr('width',data.fullWidth)
        .attr('height',data.fullHeight)
        .append("g")
        .attr('width',data.width)
        .attr('height',data.height)      
        .attr("transform", `translate(${data.margin.left},${data.margin.right})`)
        
        let space = 0;
        
        let clip = svg
        .append("clipPath")
        .attr("id", "letter-clip")
        .selectAll(".letter")
        .data(paths)
        .enter()
        .append("path")
        .attr("d",function(d){return d.path})
        .attr("class",function(d){return `letter ${d.letter}`})
        .attr("transform",function(d){
          let translate = `scale(3,3) translate(${space},0)`
          space += this.getBBox().width + 10
          return translate
        })
        
       let c10 = d3.schemePaired;
       
       let points = d3.range(20).map(i => ({
          x: Math.random() * (data.width - data.radius) + data.radius,
          y: Math.random() * (data.height - data.radius) + data.radius,
        }));
       
       let velocities = d3.range(20).map(i=>({vx:0,vy:0}))
       
      let voronoi = d3.Delaunay
      .from(points, d => d.x, d => d.y)
      .voronoi([0, 0, data.width, data.height]);
       
       let cellUpdate = ()=>{
          let cell = svg
          .selectAll(".cell")
          .data(points)
          
          cell
          .exit()
          .remove()
         
          cell
          .transition()
          .duration(1000)
          .attr("d", (d,i)=>voronoi.renderCell(i))
         
          cell
          .enter()
          .append("path")
          .attr('class', function(d,i){return `cell${i}`})
          .attr("stroke", "#ccc")
          .attr("clip-path","url(#letter-clip)")
          .attr("fill",(d,i)=>c10[i%10])
          .attr("stroke-width", 1)
          .attr("d", (d,i)=>voronoi.renderCell(i))
          
       }
       
      let meshUpdate = ()=>{
        let mesh = svg
        .selectAll(".mesh")
        .data([0])
        
        mesh
        .transition
        .duration(1000)
        .attr("d", voronoi.render());
        
        mesh
        .enter()
        .append("path")
        .attr('class', "mesh")
        .attr("fill", "none")
        .attr("stroke", "#ccc")
        .attr("stroke-width", 1)
        .attr("d", voronoi.render());
      }

      let update = ()=>{
          points.forEach((point,i)=>{
            point.x = point.x + velocities[i].vx % data.width
            point.y = point.y + velocities[i].vy % data.height
            velocities[i].vx = 1 * (Math.random() - 2) - 0.05 * velocities[i].vx
            velocities[i].vy = 1 * (Math.random() - 2) - 0.05 * velocities[i].vy
          })
          voronoi = d3.Delaunay.from(points, d => d.x, d => d.y).voronoi([0, 0, data.width, data.height]);
          cellUpdate()
          meshUpdate()
      }
       
    </script>
  </body>
</html>
