<html>
  <head>
    <title>Bradi.sh</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="paths.js"></script>
  </head>
  <body>
     <div id = "d3" style="width:100 vw;height:100 vh"></div>
     <script>
        let data = {
          fullWidth:800,
          fullHeight:300,
          margin:{
            left:10,
            right:10,
            top:10,
            bottom:10
          }
        };
        data.width = data.fullWidth - data.margin.left - data.margin.right
        data.height = data.fullHeight - data.margin.top - data.margin.bottom
        let svg = d3.select("#d3")
        .append("svg")
        .attr('width',data.fullWidth)
        .attr('height',data.fullHeight)
        .append("g")
        .attr('width',data.width)
        .attr('height',data.height)      
        .attr("transform", `translate(${data.margin.left},${data.margin.right})`)
        
        let space = 0;
        
        let clip = svg
        .append("clipPath")
        .attr("id", "letter-clip")
        .selectAll(".letter")
        .data(paths)
        .enter()
        .append("path")
        .attr("d",function(d){return d.path})
        .attr("class",function(d){return `letter ${d.letter}`})
        .attr("transform",function(d){
          let translate = `scale(3,3) translate(${space},0)`
          space += this.getBBox().width + 10
          return translate
        })
        
       let c10 = d3.schemePaired;
       
       let nodes = [{},{}];
       
       let voronoi = d3.voronoi().extent([[0, 0], [data.width, data.height]]);
        
       let getPolygons = ()=>{
         nodes.forEach(node=>{
          node.x = Math.max(0,Math.min(data.width,node.x))
          node.y = Math.max(0,Math.min(data.height,node.y))
         })
         return voronoi.polygons(nodes)
       }
       
       let polyline = (line)=>{
          return "M" + line.join("L") + "Z"
       }
       
       let background;
       
       let bind = ()=>{
         background = svg
         .selectAll(".voronoi.path")
         .data(getPolygons())
       }
       
       let exit = ()=>{
          background
         .exit()
         .remove()
       }
       
       let update = ()=>{
         background
         .attr("d",polyline);
       }
      
       let enter = ()=>{
        background
        .enter()
        .append("path")
        .attr('class', 'voronoi path')
        .attr("clip-path","url(#letter-clip)")
        .attr("stroke","white") 
        .attr("fill", function(d,i) {return c10[i % 10]} )
        .attr("d",polyline);
       }
       
       let step = ()=>{
        bind()
        exit()
        update()
        enter()
        nodes.push({})
        simulation.alpha(1).restart()
        simulation.restart()
       }
       
       let simulation = d3.forceSimulation(nodes)
      .force('charge', d3.forceManyBody())
      .force('center', d3.forceCenter(data.width / 2, data.height / 2))
      .on('tick', step);
       
    </script>
  </body>
</html>
